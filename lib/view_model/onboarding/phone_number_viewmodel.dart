import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';

class PhoneNumberViewModel extends ChangeNotifier {
  final TextEditingController phoneController = TextEditingController();
  String selectedCountryCode = '+92';

  List<Map<String, String>> countryCodes = [
    {'code': '+93', 'flag': 'ğŸ‡¦ğŸ‡«'},
    {'code': '+355', 'flag': 'ğŸ‡¦ğŸ‡±'},
    {'code': '+213', 'flag': 'ğŸ‡©ğŸ‡¿'},
    {'code': '+1', 'flag': 'ğŸ‡ºğŸ‡¸'},
    {'code': '+376', 'flag': 'ğŸ‡¦ğŸ‡©'},
    {'code': '+244', 'flag': 'ğŸ‡¦ğŸ‡´'},
    {'code': '+1-268', 'flag': 'ğŸ‡¦ğŸ‡¬'},
    {'code': '+54', 'flag': 'ğŸ‡¦ğŸ‡·'},
    {'code': '+374', 'flag': 'ğŸ‡¦ğŸ‡²'},
    {'code': '+297', 'flag': 'ğŸ‡¦ğŸ‡¼'},
    {'code': '+61', 'flag': 'ğŸ‡¦ğŸ‡º'},
    {'code': '+43', 'flag': 'ğŸ‡¦ğŸ‡¹'},
    {'code': '+994', 'flag': 'ğŸ‡¦ğŸ‡¿'},
    {'code': '+1-242', 'flag': 'ğŸ‡§ğŸ‡¸'},
    {'code': '+973', 'flag': 'ğŸ‡§ğŸ‡­'},
    {'code': '+880', 'flag': 'ğŸ‡§ğŸ‡©'},
    {'code': '+1-246', 'flag': 'ğŸ‡§ğŸ‡§'},
    {'code': '+375', 'flag': 'ğŸ‡§ğŸ‡¾'},
    {'code': '+32', 'flag': 'ğŸ‡§ğŸ‡ª'},
    {'code': '+501', 'flag': 'ğŸ‡§ğŸ‡¿'},
    {'code': '+229', 'flag': 'ğŸ‡§ğŸ‡¯'},
    {'code': '+975', 'flag': 'ğŸ‡§ğŸ‡¹'},
    {'code': '+591', 'flag': 'ğŸ‡§ğŸ‡´'},
    {'code': '+387', 'flag': 'ğŸ‡§ğŸ‡¦'},
    {'code': '+267', 'flag': 'ğŸ‡§ğŸ‡¼'},
    {'code': '+55', 'flag': 'ğŸ‡§ğŸ‡·'},
    {'code': '+673', 'flag': 'ğŸ‡§ğŸ‡³'},
    {'code': '+359', 'flag': 'ğŸ‡§ğŸ‡¬'},
    {'code': '+226', 'flag': 'ğŸ‡§ğŸ‡«'},
    {'code': '+257', 'flag': 'ğŸ‡§ğŸ‡®'},
    {'code': '+855', 'flag': 'ğŸ‡°ğŸ‡­'},
    {'code': '+237', 'flag': 'ğŸ‡¨ğŸ‡²'},
    {'code': '+1', 'flag': 'ğŸ‡¨ğŸ‡¦'},
    {'code': '+238', 'flag': 'ğŸ‡¨ğŸ‡»'},
    {'code': '+236', 'flag': 'ğŸ‡¨ğŸ‡«'},
    {'code': '+235', 'flag': 'ğŸ‡¹ğŸ‡©'},
    {'code': '+56', 'flag': 'ğŸ‡¨ğŸ‡±'},
    {'code': '+86', 'flag': 'ğŸ‡¨ğŸ‡³'},
    {'code': '+57', 'flag': 'ğŸ‡¨ğŸ‡´'},
    {'code': '+269', 'flag': 'ğŸ‡°ğŸ‡²'},
    {'code': '+506', 'flag': 'ğŸ‡¨ğŸ‡·'},
    {'code': '+385', 'flag': 'ğŸ‡­ğŸ‡·'},
    {'code': '+53', 'flag': 'ğŸ‡¨ğŸ‡º'},
    {'code': '+357', 'flag': 'ğŸ‡¨ğŸ‡¾'},
    {'code': '+420', 'flag': 'ğŸ‡¨ğŸ‡¿'},
    {'code': '+45', 'flag': 'ğŸ‡©ğŸ‡°'},
    {'code': '+253', 'flag': 'ğŸ‡©ğŸ‡¯'},
    {'code': '+1-767', 'flag': 'ğŸ‡©ğŸ‡²'},
    {'code': '+1-809', 'flag': 'ğŸ‡©ğŸ‡´'},
    {'code': '+593', 'flag': 'ğŸ‡ªğŸ‡¨'},
    {'code': '+20', 'flag': 'ğŸ‡ªğŸ‡¬'},
    {'code': '+503', 'flag': 'ğŸ‡¸ğŸ‡»'},
    {'code': '+240', 'flag': 'ğŸ‡¬ğŸ‡¶'},
    {'code': '+291', 'flag': 'ğŸ‡ªğŸ‡·'},
    {'code': '+372', 'flag': 'ğŸ‡ªğŸ‡ª'},
    {'code': '+268', 'flag': 'ğŸ‡¸ğŸ‡¿'},
    {'code': '+251', 'flag': 'ğŸ‡ªğŸ‡¹'},
    {'code': '+679', 'flag': 'ğŸ‡«ğŸ‡¯'},
    {'code': '+358', 'flag': 'ğŸ‡«ğŸ‡®'},
    {'code': '+33', 'flag': 'ğŸ‡«ğŸ‡·'},
    {'code': '+241', 'flag': 'ğŸ‡¬ğŸ‡¦'},
    {'code': '+220', 'flag': 'ğŸ‡¬ğŸ‡²'},
    {'code': '+995', 'flag': 'ğŸ‡¬ğŸ‡ª'},
    {'code': '+49', 'flag': 'ğŸ‡©ğŸ‡ª'},
    {'code': '+233', 'flag': 'ğŸ‡¬ğŸ‡­'},
    {'code': '+30', 'flag': 'ğŸ‡¬ğŸ‡·'},
    {'code': '+1-473', 'flag': 'ğŸ‡¬ğŸ‡©'},
    {'code': '+502', 'flag': 'ğŸ‡¬ğŸ‡¹'},
    {'code': '+224', 'flag': 'ğŸ‡¬ğŸ‡³'},
    {'code': '+245', 'flag': 'ğŸ‡¬ğŸ‡¼'},
    {'code': '+592', 'flag': 'ğŸ‡¬ğŸ‡¾'},
    {'code': '+509', 'flag': 'ğŸ‡­ğŸ‡¹'},
    {'code': '+504', 'flag': 'ğŸ‡­ğŸ‡³'},
    {'code': '+36', 'flag': 'ğŸ‡­ğŸ‡º'},
    {'code': '+354', 'flag': 'ğŸ‡®ğŸ‡¸'},
    {'code': '+91', 'flag': 'ğŸ‡®ğŸ‡³'},
    {'code': '+62', 'flag': 'ğŸ‡®ğŸ‡©'},
    {'code': '+98', 'flag': 'ğŸ‡®ğŸ‡·'},
    {'code': '+964', 'flag': 'ğŸ‡®ğŸ‡¶'},
    {'code': '+353', 'flag': 'ğŸ‡®ğŸ‡ª'},
    {'code': '+972', 'flag': 'ğŸ‡®ğŸ‡±'},
    {'code': '+39', 'flag': 'ğŸ‡®ğŸ‡¹'},
    {'code': '+1-876', 'flag': 'ğŸ‡¯ğŸ‡²'},
    {'code': '+81', 'flag': 'ğŸ‡¯ğŸ‡µ'},
    {'code': '+962', 'flag': 'ğŸ‡¯ğŸ‡´'},
    {'code': '+7', 'flag': 'ğŸ‡°ğŸ‡¿'},
    {'code': '+254', 'flag': 'ğŸ‡°ğŸ‡ª'},
    {'code': '+686', 'flag': 'ğŸ‡°ğŸ‡®'},
    {'code': '+383', 'flag': 'ğŸ‡½ğŸ‡°'},
    {'code': '+965', 'flag': 'ğŸ‡°ğŸ‡¼'},
    {'code': '+996', 'flag': 'ğŸ‡°ğŸ‡¬'},
    {'code': '+856', 'flag': 'ğŸ‡±ğŸ‡¦'},
    {'code': '+371', 'flag': 'ğŸ‡±ğŸ‡»'},
    {'code': '+961', 'flag': 'ğŸ‡±ğŸ‡§'},
    {'code': '+266', 'flag': 'ğŸ‡±ğŸ‡¸'},
    {'code': '+231', 'flag': 'ğŸ‡±ğŸ‡·'},
    {'code': '+218', 'flag': 'ğŸ‡±ğŸ‡¾'},
    {'code': '+423', 'flag': 'ğŸ‡±ğŸ‡®'},
    {'code': '+370', 'flag': 'ğŸ‡±ğŸ‡¹'},
    {'code': '+352', 'flag': 'ğŸ‡±ğŸ‡º'},
    {'code': '+261', 'flag': 'ğŸ‡²ğŸ‡¬'},
    {'code': '+265', 'flag': 'ğŸ‡²ğŸ‡¼'},
    {'code': '+60', 'flag': 'ğŸ‡²ğŸ‡¾'},
    {'code': '+960', 'flag': 'ğŸ‡²ğŸ‡»'},
    {'code': '+223', 'flag': 'ğŸ‡²ğŸ‡±'},
    {'code': '+356', 'flag': 'ğŸ‡²ğŸ‡¹'},
    {'code': '+692', 'flag': 'ğŸ‡²ğŸ‡­'},
    {'code': '+222', 'flag': 'ğŸ‡²ğŸ‡·'},
    {'code': '+230', 'flag': 'ğŸ‡²ğŸ‡º'},
    {'code': '+52', 'flag': 'ğŸ‡²ğŸ‡½'},
    {'code': '+691', 'flag': 'ğŸ‡«ğŸ‡²'},
    {'code': '+373', 'flag': 'ğŸ‡²ğŸ‡©'},
    {'code': '+377', 'flag': 'ğŸ‡²ğŸ‡¨'},
    {'code': '+976', 'flag': 'ğŸ‡²ğŸ‡³'},
    {'code': '+382', 'flag': 'ğŸ‡²ğŸ‡ª'},
    {'code': '+1-664', 'flag': 'ğŸ‡²ğŸ‡¸'},
    {'code': '+212', 'flag': 'ğŸ‡²ğŸ‡¦'},
    {'code': '+258', 'flag': 'ğŸ‡²ğŸ‡¿'},
    {'code': '+95', 'flag': 'ğŸ‡²ğŸ‡²'},
    {'code': '+264', 'flag': 'ğŸ‡³ğŸ‡¦'},
    {'code': '+674', 'flag': 'ğŸ‡³ğŸ‡·'},
    {'code': '+977', 'flag': 'ğŸ‡³ğŸ‡µ'},
    {'code': '+31', 'flag': 'ğŸ‡³ğŸ‡±'},
    {'code': '+599', 'flag': 'ğŸ‡§ğŸ‡¶'},
    {'code': '+687', 'flag': 'ğŸ‡³ğŸ‡¨'},
    {'code': '+64', 'flag': 'ğŸ‡³ğŸ‡¿'},
    {'code': '+505', 'flag': 'ğŸ‡³ğŸ‡®'},
    {'code': '+227', 'flag': 'ğŸ‡³ğŸ‡ª'},
    {'code': '+234', 'flag': 'ğŸ‡³ğŸ‡¬'},
    {'code': '+683', 'flag': 'ğŸ‡³ğŸ‡º'},
    {'code': '+672', 'flag': 'ğŸ‡³ğŸ‡«'},
    {'code': '+850', 'flag': 'ğŸ‡°ğŸ‡µ'},
    {'code': '+47', 'flag': 'ğŸ‡³ğŸ‡´'},
    {'code': '+968', 'flag': 'ğŸ‡´ğŸ‡²'},
    {'code': '+92', 'flag': 'ğŸ‡µğŸ‡°'},
    {'code': '+680', 'flag': 'ğŸ‡µğŸ‡¼'},
    {'code': '+507', 'flag': 'ğŸ‡µğŸ‡¦'},
    {'code': '+675', 'flag': 'ğŸ‡µğŸ‡¬'},
    {'code': '+595', 'flag': 'ğŸ‡µğŸ‡¾'},
    {'code': '+51', 'flag': 'ğŸ‡µğŸ‡ª'},
    {'code': '+63', 'flag': 'ğŸ‡µğŸ‡­'},
    {'code': '+48', 'flag': 'ğŸ‡µğŸ‡±'},
    {'code': '+351', 'flag': 'ğŸ‡µğŸ‡¹'},
    {'code': '+974', 'flag': 'ğŸ‡¶ğŸ‡¦'},
    {'code': '+40', 'flag': 'ğŸ‡·ğŸ‡´'},
    {'code': '+7', 'flag': 'ğŸ‡·ğŸ‡º'},
    {'code': '+250', 'flag': 'ğŸ‡·ğŸ‡¼'},
    {'code': '+590', 'flag': 'ğŸ‡§ğŸ‡±'},
    {'code': '+290', 'flag': 'ğŸ‡¸ğŸ‡­'},
    {'code': '+1-869', 'flag': 'ğŸ‡°ğŸ‡³'},
    {'code': '+1-758', 'flag': 'ğŸ‡±ğŸ‡¨'},
    {'code': '+508', 'flag': 'ğŸ‡µğŸ‡²'},
    {'code': '+1-784', 'flag': 'ğŸ‡»ğŸ‡¨'},
    {'code': '+685', 'flag': 'ğŸ‡¼ğŸ‡¸'},
    {'code': '+378', 'flag': 'ğŸ‡¸ğŸ‡²'},
    {'code': '+239', 'flag': 'ğŸ‡¸ğŸ‡¹'},
    {'code': '+966', 'flag': 'ğŸ‡¸ğŸ‡¦'},
    {'code': '+221', 'flag': 'ğŸ‡¸ğŸ‡³'},
    {'code': '+381', 'flag': 'ğŸ‡·ğŸ‡¸'},
    {'code': '+248', 'flag': 'ğŸ‡¸ğŸ‡¨'},
    {'code': '+232', 'flag': 'ğŸ‡¸ğŸ‡±'},
    {'code': '+65', 'flag': 'ğŸ‡¸ğŸ‡¬'},
    {'code': '+421', 'flag': 'ğŸ‡¸ğŸ‡°'},
    {'code': '+386', 'flag': 'ğŸ‡¸ğŸ‡®'},
    {'code': '+677', 'flag': 'ğŸ‡¸ğŸ‡§'},
    {'code': '+252', 'flag': 'ğŸ‡¸ğŸ‡´'},
    {'code': '+27', 'flag': 'ğŸ‡¿ğŸ‡¦'},
    {'code': '+34', 'flag': 'ğŸ‡ªğŸ‡¸'},
    {'code': '+94', 'flag': 'ğŸ‡±ğŸ‡°'},
    {'code': '+249', 'flag': 'ğŸ‡¸ğŸ‡©'},
    {'code': '+597', 'flag': 'ğŸ‡¬ğŸ‡¾'},
    {'code': '+268', 'flag': 'ğŸ‡¸ğŸ‡¿'},
    {'code': '+46', 'flag': 'ğŸ‡¸ğŸ‡ª'},
    {'code': '+41', 'flag': 'ğŸ‡¨ğŸ‡­'},
    {'code': '+963', 'flag': 'ğŸ‡¸ğŸ‡¾'},
    {'code': '+886', 'flag': 'ğŸ‡¹ğŸ‡¼'},
    {'code': '+992', 'flag': 'ğŸ‡¹ğŸ‡¯'},
    {'code': '+255', 'flag': 'ğŸ‡¹ğŸ‡¿'},
    {'code': '+66', 'flag': 'ğŸ‡¹ğŸ‡­'},
    {'code': '+228', 'flag': 'ğŸ‡¹ğŸ‡¬'},
    {'code': '+690', 'flag': 'ğŸ‡¹ğŸ‡°'},
    {'code': '+676', 'flag': 'ğŸ‡¹ğŸ‡´'},
    {'code': '+216', 'flag': 'ğŸ‡¹ğŸ‡³'},
    {'code': '+90', 'flag': 'ğŸ‡¹ğŸ‡·'},
    {'code': '+993', 'flag': 'ğŸ‡¹ğŸ‡²'},
    {'code': '+1-649', 'flag': 'ğŸ‡¹ğŸ‡¨'},
    {'code': '+688', 'flag': 'ğŸ‡¹ğŸ‡»'},
    {'code': '+256', 'flag': 'ğŸ‡ºğŸ‡¬'},
    {'code': '+380', 'flag': 'ğŸ‡ºğŸ‡¦'},
    {'code': '+971', 'flag': 'ğŸ‡¦ğŸ‡ª'},
    {'code': '+44', 'flag': 'ğŸ‡¬ğŸ‡§'},
    {'code': '+1', 'flag': 'ğŸ‡ºğŸ‡¸'},
    {'code': '+598', 'flag': 'ğŸ‡ºğŸ‡¾'},
    {'code': '+998', 'flag': 'ğŸ‡ºğŸ‡¿'},
    {'code': '+678', 'flag': 'ğŸ‡»ğŸ‡º'},
    {'code': '+58', 'flag': 'ğŸ‡»ğŸ‡ª'},
    {'code': '+84', 'flag': 'ğŸ‡»ğŸ‡³'},
    {'code': '+681', 'flag': 'ğŸ‡¼ğŸ‡«'},
    {'code': '+967', 'flag': 'ğŸ‡¾ğŸ‡ª'},
    {'code': '+260', 'flag': 'ğŸ‡¿ğŸ‡²'},
    {'code': '+263', 'flag': 'ğŸ‡¿ğŸ‡¼'},
  ];

  void changeCountry(String value) {
    selectedCountryCode = value;
    notifyListeners();
  }

  /// Save phone number to Firestore under the current user's document
  Future<void> savePhoneNumber() async {
    try {
      // Get currently signed-in user
      User? user = FirebaseAuth.instance.currentUser;

      if (user != null) {
        // Combine country code with phone number
        String fullPhone = '$selectedCountryCode${phoneController.text.trim()}';

        // Update the existing user document
        await FirebaseFirestore.instance
            .collection('users')
            .doc(user.uid) // UID ensures we update the correct user
            .update({'phoneNumber': fullPhone});
      } else {
        throw 'User not signed in';
      }
    } catch (e) {
      throw 'Failed to save phone number: $e';
    }
  }

  @override
  void dispose() {
    phoneController.dispose();
    super.dispose();
  }
}
